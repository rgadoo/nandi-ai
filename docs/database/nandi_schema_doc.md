# Nandi 2.0 Schema Documentation

## üßç Users
**Purpose:** Root identity of the seeker.  
**Used in:** All app flows (journaling, insights, karma).  
**Why:** Nandi offers personalized guidance ‚Äî identity is essential.

| Field | Type | Description |
|-------|------|-------------|
| id | UUID | Primary key |
| email | TEXT | Unique email/login ID |
| name | TEXT | Display or nickname |
| created_at, updated_at | TIMESTAMP | Lifecycle metadata |

## üï∞Ô∏è User Sessions
**Purpose:** Tracks each app usage session.  
**Used in:** Resume flows, streaks, analytics.  
**Why:** Spiritual growth is temporal ‚Äî sessions help measure consistency.

| Field | Type | Description |
|-------|------|-------------|
| id | UUID | Primary key |
| user_id | UUID | FK to users |
| started_at | TIMESTAMP | When user started |
| ended_at | TIMESTAMP | When user ended |
| metadata | JSONB | Optional device/mood/etc. |
| created_at, updated_at | TIMESTAMP | Lifecycle metadata |

## üîÅ Activity Occurrences
**Purpose:** Logs every meaningful activity in Nandi.  
**Used in:** Points, insights, analytics, sequences.  
**Why:** Every step of the seeker leaves a karmic footprint.

| Field | Type | Description |
|-------|------|-------------|
| id | UUID | Unique event |
| user_id | UUID | Who did the activity |
| session_id | UUID | Optional FK to user_sessions |
| activity_type | TEXT | ASK_NANDI, QUIZ, GAME, etc. |
| reference_id | UUID | FK to actual activity (quiz_id etc.) |
| started_at | TIMESTAMP | When it started |
| completed_at | TIMESTAMP | When it ended |
| metadata | JSONB | Optional additional state |
| created_at, updated_at | TIMESTAMP | Standard audit |

## üéØ Activity Points Mapping
**Purpose:** Defines how many points each activity awards.  
**Used in:** Admin config, dashboards.  
**Why:** Keeps karma proportional across features.

| Field | Type | Description |
|-------|------|-------------|
| id | SERIAL | Internal row ID |
| activity_type | TEXT | QUIZ, ASK_NANDI, etc. |
| points_source | TEXT | COMPLETION, BONUS, etc. |
| description | TEXT | Notes for display |
| default_points | INTEGER | Assigned base value |
| created_at, updated_at | TIMESTAMP | Audit metadata |

## ü™ô Points History
**Purpose:** Immutable karma log.  
**Used in:** Progress graphs, streak systems.  
**Why:** All growth in Nandi earns traceable credit.

| Field | Type | Description |
|-------|------|-------------|
| id | UUID | Primary key |
| user_id | UUID | Who earned the points |
| activity_occurrence_id | UUID | What event triggered it |
| points_earned | INTEGER | Total earned |
| source | TEXT | QUIZ, ASK_NANDI, etc. |
| awarded_at | TIMESTAMP | When given |
| created_at, updated_at | TIMESTAMP | Audit info |

## üí¨ General Chat Messages
**Purpose:** Logs full conversations between Nandi and the user.  
**Used in:** Memory, summarization, training.  
**Why:** Dialogue is where trust builds ‚Äî this is the temple's echo.

| Field | Type | Description |
|-------|------|-------------|
| id | UUID | Chat message ID |
| user_id | UUID | Speaker |
| session_id | UUID | When this was said |
| activity_occurrence_id | UUID | Optional FK |
| role | TEXT | user / nandi |
| message | TEXT | Actual message |
| sequence_number | INTEGER | Order in thread |
| topic | TEXT | Optional tag/topic |
| context_hash | TEXT | For embedding/training hooks |
| metadata | JSONB | Optional state |
| created_at, updated_at | TIMESTAMP | Lifecycle |

## üß† Agent Insights
**Purpose:** Stores intelligence generated by agents.  
**Used in:** Reflection scoring, tag clustering, dharmic analysis.  
**Why:** Every seeker deserves intelligent guidance ‚Äî these are Nandi's observations.

| Field | Type | Description |
|-------|------|-------------|
| id | UUID | Unique insight |
| user_id | UUID | For whom |
| activity_occurrence_id | UUID | Context for insight |
| insight_type | TEXT | e.g. DEPTH_SCORE, PATTERN_CLUSTER |

## üó£Ô∏è Ask Nandi Conversations
**Purpose:** Logs user questions and Nandi's direct response.  
**Used in:** Inner Dialogue, AI summary.  
**Why:** This is Jnana Yoga ‚Äî structured self-inquiry.

| Field | Type | Description |
|-------|------|-------------|
| id | UUID | Conversation ID |
| user_id | UUID | Who asked |
| question | TEXT | Full input |
| tone | TEXT | Scientific, spiritual, etc. |
| response | TEXT | Raw streamed reply |
| reflective_summary | TEXT | Optional insight |
| created_at, updated_at | TIMESTAMP | Metadata |

## ‚úçÔ∏è Ask Nandi Reflections
**Purpose:** User's free-written follow-up to a Nandi chat.  
**Used in:** Summaries, streak depth, agent scoring.  
**Why:** Transformation happens after the reply.

| Field | Type | Description |
|-------|------|-------------|
| id | UUID | Entry ID |
| conversation_id | UUID | FK to Nandi convo |
| user_id | UUID | Writer |
| journal_entry | TEXT | Body |
| tags | TEXT[] | Concepts like trust, silence |
| created_at, updated_at | TIMESTAMP | Metadata |

## üìì Reflection Journal Entries
**Purpose:** Generic journaling, either guided or silent.  
**Used in:** Reflection dashboards, insight loop.  
**Why:** Silent writing is itself a yogic path.

| Field | Type | Description |
|-------|------|-------------|
| id | UUID | Primary key |
| user_id | UUID | FK to users |
| content | TEXT | Journal content |
| tags | TEXT[] | Optional label themes |
| created_at, updated_at | TIMESTAMP | Metadata |

## ‚ùì Quizzes
**Purpose:** Template for story-based or insight-based decision making.  
**Used in:** Insight Loops, Moral Play.  
**Why:** Quizzes simulate choices with dharmic impact.

| Field | Type | Description |
|-------|------|-------------|
| id | UUID | Quiz ID |
| title | TEXT | Display name |
| type | TEXT | INSIGHT_LOOP, etc. |
| prompt | TEXT | Description or story |
| source | TEXT | GPT, Admin |
| created_by | UUID | Optional FK to user |
| created_at, updated_at | TIMESTAMP | Metadata |

## ‚úÖ Quiz Questions
| Field | Type | Description |
|-------|------|-------------|
| id | UUID | Question ID |
| quiz_id | UUID | Parent FK |
| question | TEXT | Text |
| options | JSONB | All options A/B/C |
| correct_option | TEXT | Optional if scored |
| metadata | JSONB | Agent annotation support |
| created_at, updated_at | TIMESTAMP | Metadata |

## ‚úÖ Quiz Responses
| Field | Type | Description |
|-------|------|-------------|
| id | UUID | Unique answer set |
| quiz_id | UUID | From which quiz |
| user_id | UUID | Who answered |
| session_id | UUID | Optional link |
| responses | JSONB | Actual answers |
| score | INT | Computed result |
| created_at, updated_at | TIMESTAMP | Metadata |

## üéÆ Games
##  and
## Game Sessions
**Purpose:** Allow seekers to engage in focus/moral games.  
**Used in:** Puzzle card, breathing games, dharma choices.

| games Table |
| Field | Type | Description |
|-------|------|-------------|
| id | UUID | Game ID |
| name | TEXT | Name |
| url | TEXT | Link to embed |
| category | TEXT | Puzzle, Focus, etc. |
| created_at, updated_at | TIMESTAMP | Metadata |

| game_sessions Table |
| Field | Type | Description |
|-------|------|-------------|
| id | UUID | Game play instance |
| user_id | UUID | Who played |
| game_id | UUID | Which game |
| score | INT | Optional |
| metadata | JSONB | Context |
| started_at, ended_at | TIMESTAMP | Time spent |
| created_at, updated_at | TIMESTAMP | Metadata |
